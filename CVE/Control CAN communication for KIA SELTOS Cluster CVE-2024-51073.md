# CVE-2024-51073

## Description
The vulnerability involves the exploitation of the UDS (Unified Diagnostic Services) Service $28 (Communication Control) to control or disrupt CAN communication in a KIA seltos vehicle cluster system.

**Vulnerability Score**: **6.7** **Medium** [AV:P/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:H](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:P/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:H&version=3.1)

## Impact
The impact of controlling CAN communication via UDS Service $28 (Communication Control) in a vehicle system, particularly targeting the instrument cluster, can be significant and multifaceted. The instrument cluster is a critical component for providing real-time information to the driver, and its disruption or manipulation can have severe consequences such as Safety Risks, Operational Issues,	Financial Losses,	Security Threats

## Exploitation Details
To exploit the UDS protocol with black box testing approach, identifying the correct CAN IDs for diagnostic requests and responses is essential. For this, we utilized an incremental fuzzing approach within the standard CAN ID range (0x000 to 0x7FF). Using the "Tester Present" ($3E) service as the payload, we captured positive responses to identify the diagnostic request and response CAN ID pairs.

The identified CAN ID pair used for further testing was **0x7C6 (Request) and 0x7CE (Response)**, as shown in the image below

![image](https://github.com/user-attachments/assets/6f1b2fa4-b993-49da-9a98-0c0f6bfd9337)

Once the diagnostic communication was established, we enumerated the UDS services supported by the ECU. This was achieved through 1-byte fuzzing of the UDS service field, which allowed us to capture all positive responses. The supported UDS services for the cluster, including "Communication Control" ($28) and "Hard Reset" ($11), are illustrated in the results below.

![image](https://github.com/user-attachments/assets/48117f90-8307-4806-b2dc-dab936dd2f41)


Among the identified services, we focused on exploiting the Communication Control ($28) and Hard Reset ($11) services:
Communication Control ($28): This service is used to enable or disable the transmission of application messages by the ECU.
To successfully exploit this service, precise payload values are required. To determine these, we performed a 2-byte incremental fuzzing process on the $28 service to identify valid payloads.

**Disabling the CAN messages transmitted by cluster**

Through fuzzing, we identified the precise payload required to disable the CAN messages transmitted by the instrument cluster. When a diagnostic request with the payload **'0x280303**' was sent to the cluster using the Communication Control ($28) service, the cluster responded with a positive acknowledgment. Following this, all CAN message transmissions from the cluster ceased, confirming the effectiveness of the payload.

The image below demonstrates the cluster’s response and the absence of transmitted CAN messages post-execution of the diagnostic request

![image](https://github.com/user-attachments/assets/df3a9847-a788-4f47-b111-a15a34c8b24d)

**Enable the CAN messages transmitted by cluster**

Through fuzzing, we identified the precise payload required to enable the CAN messages transmitted by the instrument cluster. When a diagnostic request with the payload **'0x280003'** was sent to the cluster using the Communication Control ($28) service, the cluster responded with a positive acknowledgment.

The image below demonstrates the cluster’s response

![image](https://github.com/user-attachments/assets/699f2656-a6c7-46db-ac22-c5ecec982024)


This vulnerability is highly critical due to its significant potential impact on vehicle safety, security, and functionality.


## Mitigations / Fixes
1. Implement strong authentication and encryption for accessing UDS services communication control($28) using security access($27) service.
2. Use secure diagnostic sessions with robust key management.
